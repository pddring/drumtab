<!DOCTYPE html>
<html>
    <head>
        <title>DrumTab</title>
        <link rel="stylesheet" href="styles.css">
    <body>
        <h1>DrumTab</h1>
        <p>Interactive drum practice tool</p>
        

    <h2>Score</h2>    
    <div id="main">       
        <div class="controls">
            <button id="btn-slower">-</button>
            <input id="bpm" value="60">
            <button id="btn-faster">+</button>
            <button id="btn-play-stop">Play</button>
            <select id="repeat">
                <option value="1">No repeat</option>
                <option value="2">x2</option>
                <option value="4">x4</option>
                <option value="8">x8</option>
                <option value="16" selected>x16</option>
                <option value="32">x32</option>
                <option value="64">x64</option>
            </select>
        </div>

        <div id="score"></div>

        <canvas id="drums" width="600" height="600">
        </canvas>
    </div>
    

    
    

    <h2>Tab</h2>
        <p>Type out or copy your drum tab here</p>
<textarea id="tab">
HH|x-x-x-x-x-x-x-x-|
 S|----o-------o---|
 B|O-------o-------|
   1 + 2 + 3 + 4 +
</textarea>
<select id="voicing">
    <option value="0">Single voice</option>
    <option value="1" selected>Hands and feet</option>
    <option value="2">Cymbals and drums</option>
</select>

    <h2>ABC</h2>
    <p>This will (eventually) be auto generated from the drum tab</p>
<textarea id="abc">

</textarea>
    <script src="lib/abcjs-basic-min.js"></script> 
    <script src="media/jdd200/kit.js"></script>
    <script src="drumtab.js"></script> 
    <script>
        drumtab.init("drums");
        const eTab = document.getElementById("tab");
        const eAbc = document.getElementById("abc");
        const eScore = document.getElementById("score");
        const eVoicing = document.getElementById("voicing");
        const ePlayStop = document.getElementById("btn-play-stop");
        const eBPM = document.getElementById("bpm");
        const eRepeat = document.getElementById("repeat");

        eBPM.addEventListener("change", e => {
            bpm = parseInt(eBPM.value);
            updateBPM();
        });
        document.getElementById("btn-faster").addEventListener("click", e => {
            bpm += 5;
            updateBPM();
        });

        document.getElementById("btn-slower").addEventListener("click", e => {
            bpm -= 5;
            updateBPM();
        });

        var voicing = undefined;
        let playing = false;
        let bpm = 60;
        
        function updateBPM() {
            eBPM.value = bpm;
        }
        
        ePlayStop.addEventListener("click", e=> {
            if(drumtab.playing && !drumtab.playback.isPaused) {
                drumtab.pause();
                ePlayStop.innerText = "Resume";
            } else {
                ePlayStop.innerText = "Stop";
                let repeatCount = parseInt(eRepeat.value);
                drumtab.play(repeatCount, e => {
                    ePlayStop.innerText = "Play";
                });
            }
        });

        eTab.addEventListener("input", updateABC);
        eAbc.addEventListener("input", updateScore);
        eVoicing.addEventListener("change", (e => {
            voicing = drumtab.voicingOptions[e.currentTarget.value];
            updateABC();
        }));

        function updateABC() {
            let tab = eTab.value;
            eAbc.value = drumtab.Tab2ABC(tab, voicing);
            updateScore();
        }
        var selectedNotes = [];
        function updateScore() {
            let abc = eAbc.value;
            score = ABCJS.renderAbc("score", abc)[0];

        }

        updateABC();
        updateScore();


    </script>
    </body>
</html>
